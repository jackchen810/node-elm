webpackJsonp([13],{529:function(t,e,a){a(767),a(769);var o=a(200)(a(771),a(772),null,null);t.exports=o.exports},767:function(t,e,a){var o=a(768);"string"==typeof o&&(o=[[t.i,o,""]]),o.locals&&(t.exports=o.locals);a(199)("0e3cb6ba",o,!0)},768:function(t,e,a){e=t.exports=a(87)(!1),e.push([t.i,".vue-datasource *{box-sizing:border-box;font-size:14px}.vue-datasource .panel{margin-bottom:22px;background-color:#fff;border:1px solid transparent;border-radius:4px;box-shadow:0 1px 1px rgba(0,0,0,.05)}.vue-datasource .panel-default{border-color:#d3e0e9}.vue-datasource .panel-heading{padding:10px 15px;border-bottom:1px solid transparent;border-top-right-radius:3px;border-top-left-radius:3px}.vue-datasource .panel-default>.panel-heading{height:56px;color:#333;background-color:#fff;border-color:#d3e0e9}.vue-datasource .pull-left{float:left!important}.vue-datasource .pull-right{float:right!important}.vue-datasource .form-group{margin-bottom:15px}.vue-datasource label{display:inline-block;max-width:100%;margin-bottom:5px;font-weight:700}.vue-datasource .form-control{display:block;width:100%;height:36px;color:#555;background-color:#fff;border:1px solid #ccd0d2;border-radius:4px;box-shadow:inset 0 1px 1px rgba(0,0,0,.075);-webkit-transition:border-color .15s ease-in-out,box-shadow .15s ease-in-out;transition:border-color .15s ease-in-out,box-shadow .15s ease-in-out}.vue-datasource .btn,.vue-datasource .form-control{padding:6px 12px;font-size:14px;line-height:1.6;background-image:none}.vue-datasource .btn{display:inline-block;margin-bottom:0;font-weight:400;text-align:center;vertical-align:middle;touch-action:manipulation;cursor:pointer;border:1px solid transparent;white-space:nowrap;border-radius:4px;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.vue-datasource .btn-primary{color:#fff;background-color:#3097d1;border-color:#2a88bd}.vue-datasource .table{width:100%;max-width:100%;margin-bottom:22px;border-collapse:collapse;border-spacing:0;text-align:center}.vue-datasource .table>thead>tr>th{vertical-align:bottom;border-bottom:2px solid #ddd}.vue-datasource .table td,.vue-datasource .table th{padding:8px;line-height:1.6;vertical-align:top;border-top:1px solid #ddd}.vue-datasource .table-striped>tbody>tr:nth-of-type(odd){background-color:#f9f9f9}.vue-datasource .success td,.vue-datasource .success th{background-color:#dff0d8}.vue-datasource .pagination{display:inline-block;padding-left:0;margin:22px 0;border-radius:4px}.vue-datasource .pagination>li{display:inline}.pagination>li>a,.pagination>li>span{position:relative;float:left;padding:6px 12px;line-height:1.6;text-decoration:none;color:#3097d1;background-color:#fff;border:1px solid #ddd;margin-left:-1px}.pagination>.disabled>a,.pagination>.disabled>a:focus,.pagination>.disabled>a:hover,.pagination>.disabled>span,.pagination>.disabled>span:focus,.pagination>.disabled>span:hover{color:#777;background-color:#fff;border-color:#ddd;cursor:not-allowed}.pagination>.active>a,.pagination>.active>a:focus,.pagination>.active>a:hover,.pagination>.active>span,.pagination>.active>span:focus,.pagination>.active>span:hover{z-index:3;color:#fff;background-color:#3097d1;border-color:#3097d1;cursor:default}.vue-datasource .pagination>li:first-child>a,.vue-datasource .pagination>li:first-child>span{margin-left:0;border-bottom-left-radius:4px;border-top-left-radius:4px}.vue-datasource .text-center{text-align:center}@media (min-width:768px){.form-inline .form-group{display:inline-block}.form-inline .control-label,.form-inline .form-group{margin-bottom:0;vertical-align:middle}.form-inline .form-control{display:inline-block;width:auto;vertical-align:middle}}",""])},769:function(t,e,a){var o=a(770);"string"==typeof o&&(o=[[t.i,o,""]]),o.locals&&(t.exports=o.locals);a(199)("16206b12",o,!0)},770:function(t,e,a){e=t.exports=a(87)(!1),e.push([t.i,".rad-group{margin-bottom:20px}.handle-input{width:300px;display:inline-block}.handle-box2{display:inline-block;float:right}.orange{color:#eb9e05;background-color:none}.btn2{margin-bottom:5px;margin-left:0}.diainp{width:217px}.diainp2{width:400px}.inp80{width:80px}.inp100{width:100px}.inp120{width:120px}.inp150{width:140px}.inp160{width:160px}.inp180{width:180px}.nowrap{white-space:nowrap}.upload-demo .el-upload{cursor:pointer;position:relative;overflow:hidden}.upload-demo .el-upload:hover{border-color:#409eff}",""])},771:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={data:function(){return{pickerOptions:{shortcuts:[{text:"最近一周",onClick:function(t){var e=new Date,a=new Date;a.setTime(a.getTime()-6048e5),t.$emit("pick",[a,e])}},{text:"最近一个月",onClick:function(t){var e=new Date,a=new Date;a.setTime(a.getTime()-2592e6),t.$emit("pick",[a,e])}},{text:"最近三个月",onClick:function(t){var e=new Date,a=new Date;a.setTime(a.getTime()-7776e6),t.$emit("pick",[a,e])}}]},start_time:"",end_time:"",dialogFormVisible:!1,dialogMarketVisible:!1,dialogCheckVisible:!1,radio3:"全部",form:{task_id:"",task_status:"",obj_amount:"",trade_symbol:"111",trade_ktype:"1",stock_name:"www",strategy_main:"主策略",strategy_type:"1",strategy_list:[{stock_symbol:"",stock_name:"",stock_ktype:"",trade_amount:"",strategy_name:""}],start_time:"",end_time:"",market_gateway:""},rules:{start_time:[{required:!0,message:"请输入开始时间",trigger:"blur"}],end_time:[{required:!0,message:"请输入结束时间",trigger:"blur"}]},log:{message:""},formLabelWidth:"100px",formLabelWidth50:"50px",updateTimer:"",fileList3:[],loading:!1,fullscreenLoading:!1,task_list:[],strategy_file_list:[],riskctrl_file_list:[],end_time_file_list:[],market_gateway_file_list:[],valid_stock_list:[],pageTotal:1,currentPage:1,page_size:10}},created:function(){this.updateTimer&&(clearTimeout(this.updateTimer),this.updateTimer=""),this.getBackTestTaskList(1,this.page_size),this.getBacktestTaskListLength(),this.getStrategyList()},beforeDestroy:function(){this.updateTimer&&(clearTimeout(this.updateTimer),this.updateTimer=""),console.log("destory")},methods:{getBacktestTaskListLength:function(){var t=this;t.loading=!0,t.$axios.post("/api/backtest/list/length").then(function(e){t.loading=!1,0==e.data.ret_code&&(t.pageTotal=e.data.extra)})},getBackTestTaskList:function(t,e){var a=this,o={page_size:e,current_page:t};a.loading=!0,a.$axios.post("/api/backtest/list",o).then(function(t){a.loading=!1,0==t.data.ret_code?a.task_list=t.data.extra.slice(0,a.page_size):a.task_list=[]})},getTaskStatusById:function(t){var e=this,a={task_id:t};e.loading=!0,e.$axios.post("/api/backtest/task/status",a).then(function(a){if(e.loading=!1,0==a.data.ret_code){for(var o=a.data.extra,i=0;i<o.length&&"finish"==o[i].task_status;i++);if(i==o.length){for(var i=0;i<e.task_list.length;i++)e.task_list[i].task_id==t&&(e.task_list[i].task_status="finish");return}}e.updateTimer=setTimeout(function(){e.getTaskStatusById(t)},2e3)})},getStrategyList:function(){var t=this;t.loading=!0,t.$axios.post("/api/strategy/list").then(function(e){t.loading=!1,0==e.data.ret_code?t.strategy_file_list=e.data.extra:console.log("resp:",e.data)})},saveAdd:function(t){var e=this,a={strategy_type:e.form.strategy_type,strategy_list:e.form.strategy_list,start_time:e.form.start_time,end_time:e.form.end_time};e.loading=!0,e.$axios.post("/api/backtest/add",a).then(function(t){e.loading=!1,console.log(t),0==t.data.ret_code?(e.$message("添加成功"),e.getBackTestTaskList(1,e.page_size)):e.$message("添加失败:"+t.data.extra)},function(t){e.$message("添加失败"),e.loading=!1,console.log(t)})},delTask:function(t){var e=this,a={task_id:t};e.loading=!0,e.$axios.post("/api/backtest/del",a).then(function(t){e.loading=!1,0==t.data.ret_code?(e.$message("删除成功"),e.getBackTestTaskList(1,e.page_size)):e.$message(t.data.extra)},function(t){e.$message("删除失败"),e.loading=!1,console.log(t)})},startTask:function(t){var e=this,a={task_id:t};e.loading=!0,e.$axios.post("/api/backtest/start",a).then(function(a){e.loading=!1,0==a.data.ret_code?(e.$message("操作成功"),e.getBackTestTaskList(1,e.page_size),e.updateTimer=setTimeout(function(){e.getTaskStatusById(t)},2e3)):e.$message(a.data.extra)},function(t){e.$message("操作失败"),e.loading=!1,console.log(t)})},stopTask:function(t){var e=this,a={task_id:t};e.loading=!0,e.$axios.post("/api/backtest/stop",a).then(function(t){e.loading=!1,0==t.data.ret_code?(e.$message("操作成功"),e.getBackTestTaskList(1,e.page_size),clearTimeout(e.updateTimer)):e.$message(t.data.extra)},function(t){e.$message("操作失败"),e.loading=!1,console.log(t)})},page_forward:function(t){this.$router.push({name:"BacktestResult",params:{task_id:t}})},handleCurrentChange:function(t){this.currentPage=t,this.getBackTestTaskList(this.currentPage,this.page_size)},changeStockSymbol:function(t){var e=this.form.strategy_list[t].stock_symbol;if(2==this.form.strategy_type)for(var a=0;a<this.form.strategy_list.length;a++)this.form.strategy_list[a].stock_symbol=e;if(6!=e.length)return void(this.form.strategy_list[t].stock_name="");var o=this,i="";i="6"==e[0]?"/sina/list=sh"+e:"/sina/list=sz"+e,o.$axios.get(i).then(function(e){var a=e.data.match(/\"(\S*)(?=\")/);if(null!=a){var i=a[1].split(",");o.form.strategy_list[t].stock_name=i[0]}},function(e){o.form.strategy_list[t].stock_name="",console.log(e)})},changeStrategyItem:function(t){var e=this.form.strategy_list[0];1==this.form.strategy_type&&(this.form.strategy_list=[e])},removeStrategyItem:function(t){this.form.strategy_list.splice(t,1)},addStrategyItem:function(t){var e="";if(2==this.form.strategy_type)var e=this.form.strategy_list[0].stock_symbol;this.form.strategy_list.push({stock_symbol:e,stock_ktype:"",strategy_name:""})}},computed:{}}},772:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"table"},[a("div",{staticClass:"crumbs"},[a("el-breadcrumb",{attrs:{separator:"/"}},[a("el-breadcrumb-item",[a("i",{staticClass:"el-icon-star-on"}),t._v("回测任务管理")]),t._v(" "),a("el-breadcrumb-item",[t._v("回测任务列表")])],1)],1),t._v(" "),a("div",{staticClass:"handle-box rad-group"},[a("el-button",{staticClass:"handle-del mr10",attrs:{type:"primary",icon:"el-icon-plus"},on:{click:function(e){t.dialogFormVisible=!0}}},[t._v("创建回测任务")])],1),t._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"multipleTable",staticStyle:{width:"100%"},attrs:{data:t.task_list,border:""}},[a("el-table-column",{attrs:{type:"index",label:"ID",width:"60"}}),t._v(" "),a("el-table-column",{attrs:{prop:"task_type",label:"任务类型",width:"100"}}),t._v(" "),a("el-table-column",{attrs:{prop:"trade_ktype",label:"K线类型"}}),t._v(" "),a("el-table-column",{attrs:{prop:"strategy_name",label:"策略标的",width:"160"}}),t._v(" "),a("el-table-column",{attrs:{prop:"start_time",label:"开始时间"}}),t._v(" "),a("el-table-column",{attrs:{prop:"end_time",label:"结束时间"}}),t._v(" "),a("el-table-column",{attrs:{prop:"trade_symbol",label:"交易标的"}}),t._v(" "),a("el-table-column",{attrs:{prop:"task_status",label:"运行状态"}}),t._v(" "),a("el-table-column",{attrs:{label:"操作",width:"200"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{staticClass:"btn1",attrs:{type:"text",size:"small"},on:{click:function(a){t.delTask(e.row.task_id)}}},[t._v("删除")]),t._v(" "),"running"==e.row.task_status?a("el-button",{staticClass:"btn1",attrs:{type:"danger",size:"small"},on:{click:function(a){t.stopTask(e.row.task_id)}}},[t._v("停止")]):a("el-button",{staticClass:"btn1",attrs:{type:"success",size:"small"},on:{click:function(a){t.startTask(e.row.task_id)}}},[t._v("启动")]),t._v(" "),a("el-button",{staticClass:"btn1",attrs:{type:"text",size:"small"},on:{click:function(a){t.page_forward(e.row.task_id)}}},[t._v("查看结果")])]}}])})],1),t._v(" "),a("div",{staticClass:"pagination"},[a("el-pagination",{attrs:{"current-page":t.currentPage,layout:"prev, pager, next",total:t.pageTotal},on:{"current-change":t.handleCurrentChange}})],1),t._v(" "),a("el-dialog",{staticClass:"digcont",attrs:{title:"添加回测任务",visible:t.dialogFormVisible},on:{"update:visible":function(e){t.dialogFormVisible=e}}},[a("el-form",{ref:"form",attrs:{model:t.form,rules:t.rules}},[t._l(t.form.strategy_list,function(e,o){return a("el-form-item",{key:e.key,attrs:{label:"策略名称",prop:"strategy_list","label-width":t.formLabelWidth,label:"策略"+o,prop:e.key}},[a("div",{staticClass:"block"},[a("label",[t._v("股票代码：")]),t._v(" "),a("el-input",{staticClass:"inp150",attrs:{"auto-complete":"off",placeholder:"请输入股票代码"},on:{change:function(e){t.changeStockSymbol(o)}},model:{value:t.form.strategy_list[o].stock_symbol,callback:function(e){t.$set(t.form.strategy_list[o],"stock_symbol",e)},expression:"form.strategy_list[index].stock_symbol"}}),t._v(" "),a("span",{domProps:{textContent:t._s(t.form.strategy_list[o].stock_name)}})],1),t._v(" "),a("div",[a("label",[t._v("K 线周期：")]),t._v(" "),0==o&&t.form.strategy_type>1?a("el-input",{staticClass:"inp180",attrs:{"auto-complete":"off",disabled:!0},model:{value:t.form.strategy_main,callback:function(e){t.$set(t.form,"strategy_main",e)},expression:"form.strategy_main"}}):a("el-select",{staticClass:"inp180",attrs:{placeholder:"请选择K线周期"},model:{value:t.form.strategy_list[o].stock_ktype,callback:function(e){t.$set(t.form.strategy_list[o],"stock_ktype",e)},expression:"form.strategy_list[index].stock_ktype"}},[a("el-option",{attrs:{label:"1分钟",value:"1"}}),t._v(" "),a("el-option",{attrs:{label:"5分钟",value:"5"}}),t._v(" "),a("el-option",{attrs:{label:"15分钟",value:"15"}}),t._v(" "),a("el-option",{attrs:{label:"30分钟",value:"30"}}),t._v(" "),a("el-option",{attrs:{label:"60分钟",value:"60"}}),t._v(" "),a("el-option",{attrs:{label:"120分钟",value:"120"}}),t._v(" "),a("el-option",{attrs:{label:"日线",value:"day"}}),t._v(" "),a("el-option",{attrs:{label:"周线",value:"week"}}),t._v(" "),a("el-option",{attrs:{label:"月线",value:"month"}})],1)],1),t._v(" "),0==o?a("div",[a("label",[t._v("交易数量：")]),t._v(" "),a("el-input",{staticClass:"inp180",attrs:{"auto-complete":"off",placeholder:"请输入交易数量"},model:{value:t.form.strategy_list[o].trade_amount,callback:function(e){t.$set(t.form.strategy_list[o],"trade_amount",e)},expression:"form.strategy_list[index].trade_amount"}})],1):t._e(),t._v(" "),a("div",[a("label",[t._v("对应策略：")]),t._v(" "),a("el-select",{staticClass:"inp180",attrs:{placeholder:"请选择对应策略"},model:{value:t.form.strategy_list[o].strategy_name,callback:function(e){t.$set(t.form.strategy_list[o],"strategy_name",e)},expression:"form.strategy_list[index].strategy_name"}},t._l(t.strategy_file_list,function(t){return a("el-option",{key:t,attrs:{label:t,value:t}})})),t._v(" "),0==o&&1==t.form.strategy_type?a("el-button",{attrs:{disabled:!0}},[t._v("N")]):0==o&&t.form.strategy_type>1?a("el-button",{on:{click:function(e){e.preventDefault(),t.addStrategyItem(o)}}},[t._v("+")]):a("el-button",{on:{click:function(e){e.preventDefault(),t.removeStrategyItem(o)}}},[t._v("-")])],1)])}),t._v(" "),a("el-form-item",{attrs:{label:"",prop:"strategy_type",inline:!0,"label-width":t.formLabelWidth}},[a("el-radio-group",{attrs:{inline:!0},on:{change:function(e){t.changeStrategyItem(t.index)}},model:{value:t.form.strategy_type,callback:function(e){t.$set(t.form,"strategy_type",e)},expression:"form.strategy_type"}},[a("el-radio",{attrs:{label:"1"}},[t._v("简单策略")]),t._v(" "),a("el-radio",{attrs:{label:"2"}},[t._v("多级别分析策略")]),t._v(" "),a("el-radio",{attrs:{label:"3"}},[t._v("综合分析策略（策略0为主策略）")])],1)],1),t._v(" "),a("el-form-item",{attrs:{label:"开始日期",prop:"start_time","label-width":t.formLabelWidth}},[a("el-date-picker",{attrs:{align:"right",type:"date",placeholder:"选择日期","picker-options":t.pickerOptions},model:{value:t.form.start_time,callback:function(e){t.$set(t.form,"start_time",e)},expression:"form.start_time"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"结束日期",prop:"end_time","label-width":t.formLabelWidth}},[a("el-date-picker",{attrs:{align:"right",type:"date",placeholder:"选择日期"},model:{value:t.form.end_time,callback:function(e){t.$set(t.form,"end_time",e)},expression:"form.end_time"}})],1)],2),t._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.dialogFormVisible=!1}}},[t._v("退 出")]),t._v(" "),a("el-button",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:t.fullscreenLoading,expression:"fullscreenLoading",modifiers:{fullscreen:!0,lock:!0}}],attrs:{type:"primary"},on:{click:function(e){t.saveAdd("form")}}},[t._v("添 加")])],1)],1)],1)},staticRenderFns:[]}}});